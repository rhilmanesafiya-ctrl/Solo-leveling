<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo Leveling System </title>
    <link rel="icon" href="solo_leveling_icon.png" type="image/png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;700&display=swap">
    <style>
        /* Your existing CSS styles remain unchanged */
        :root {
            --dark-blue: #0a0a1f;
            --darker-blue: #050510;
            --neon-blue: #00ccff;
            --electric-blue: #0066ff;
            --panel-bg: rgba(10, 15, 35, 0.8);
            --text-color: #e0e0ff;
            --rank-e: #888888;
            --rank-d: #5555ff;
            --rank-c: #00aaff;
            --rank-b: #00ffaa;
            --rank-a: #ffaa00;
            --rank-s: #ff5500;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark-blue);
            color: var(--text-color);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(0, 102, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 85% 30%, rgba(0, 204, 255, 0.1) 0%, transparent 20%),
                linear-gradient(to bottom, var(--darker-blue) 0%, var(--dark-blue) 100%);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0, 204, 255, 0.3);
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 204, 255, 0.7);
            margin-bottom: 10px;
        }
        
        .notification {
            background-color: var(--panel-bg);
            border: 1px solid var(--electric-blue);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.3);
            animation: pulse 2s infinite;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .stats-panel {
            background-color: var(--panel-bg);
            border: 1px solid var(--electric-blue);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.3);
        }
        
        .stats-panel h2 {
            color: var(--neon-blue);
            margin-bottom: 15px;
            font-size: 1.5rem;
            font-family: 'Orbitron', sans-serif;
        }
        
        .stat-item {
            margin-bottom: 15px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a0a0ff;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .progress-bar {
            height: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid var(--electric-blue);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--electric-blue), var(--neon-blue));
            border-radius: 10px;
            transition: width 0.5s ease-in-out;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 20px 20px;
            animation: move 1s linear infinite;
            border-radius: 10px;
        }
        
        @keyframes move {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 20px 0;
            }
        }
        
        .habits-panel {
            background-color: var(--panel-bg);
            border: 1px solid var(--electric-blue);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.3);
        }
        
        .habits-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .habits-header h2 {
            color: var(--neon-blue);
            font-size: 1.5rem;
            font-family: 'Orbitron', sans-serif;
        }
        
        .btn {
            background: linear-gradient(to bottom, var(--electric-blue), #0044cc);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.7);
            transform: translateY(-2px);
        }
        
        .btn-reset {
            background: linear-gradient(to bottom, var(--electric-blue), #0044cc);
        }
        
        .btn-delete {
            background: linear-gradient(to bottom, #ff3333, #cc0000);
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .habit-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .habit-card {
            background: rgba(5, 10, 30, 0.7);
            border: 1px solid var(--electric-blue);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
            position: relative;
        }
        
        .habit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 102, 255, 0.5);
        }
        
        .habit-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--neon-blue);
            font-family: 'Orbitron', sans-serif;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .habit-rank {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 10px;
            background: rgba(0, 204, 255, 0.2);
        }
        
        .rank-e { background: var(--rank-e); color: white; }
        .rank-d { background: var(--rank-d); color: white; }
        .rank-c { background: var(--rank-c); color: white; }
        .rank-b { background: var(--rank-b); color: black; }
        .rank-a { background: var(--rank-a); color: black; }
        .rank-s { background: linear-gradient(45deg, var(--rank-s), gold); color: black; }
        
        .habit-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .habit-progress {
            margin-bottom: 15px;
        }
        
        .habit-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .check-btn {
            background: linear-gradient(to bottom, var(--electric-blue), #0044cc);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
        }
        
        .check-btn:disabled {
            background: #444;
            cursor: not-allowed;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--panel-bg);
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(0, 204, 255, 0.5);
        }
        
        .modal h2 {
            color: var(--neon-blue);
            margin-bottom: 20px;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #a0a0ff;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--electric-blue);
            border-radius: 5px;
            color: white;
            font-family: 'Orbitron', sans-serif;
        }
        
        .level-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.95);
            border: 4px solid var(--neon-blue);
            border-radius: 15px;
            padding: 40px 60px;
            text-align: center;
            z-index: 1001;
            box-shadow: 0 0 50px rgba(0, 204, 255, 0.8);
            display: none;
        }
        
        .level-up-text {
            font-size: 4rem;
            font-weight: bold;
            color: var(--neon-blue);
            text-shadow: 0 0 30px rgba(0, 204, 255, 0.9);
            animation: pulse 1.5s infinite;
            font-family: 'Orbitron', sans-serif;
        }
        
        .welcome-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.95);
            border: 4px solid var(--neon-blue);
            border-radius: 15px;
            padding: 40px 60px;
            text-align: center;
            z-index: 1001;
            box-shadow: 0 0 50px rgba(0, 204, 255, 0.8);
            display: none;
        }
        
        .welcome-text {
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--neon-blue);
            text-shadow: 0 0 30px rgba(0, 204, 255, 0.9);
            animation: pulse 1.5s infinite;
            font-family: 'Orbitron', sans-serif;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .daily-goal {
            display: flex;
            align-items: center;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .daily-goal span {
            margin-right: 10px;
        }
        
        .daily-progress {
            display: flex;
        }
        
        .daily-point {
            width: 15px;
            height: 15px;
            background-color: rgba(0, 102, 255, 0.3);
            border: 1px solid var(--electric-blue);
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .daily-point.completed {
            background-color: var(--neon-blue);
            box-shadow: 0 0 5px var(--neon-blue);
        }
        
        .countdown {
            font-size: 1.2rem;
            color: var(--neon-blue);
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border: 1px solid var(--electric-blue);
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0.3);
            font-family: 'Orbitron', sans-serif;
        }
        
        .current-level {
            text-align: center;
            font-size: 3rem;
            color: var(--neon-blue);
            text-shadow: 0 0 15px rgba(0, 204, 255, 0.7);
            margin: 20px 0;
            font-family: 'Orbitron', sans-serif;
        }
        
        /* NEW STYLES */
        .system-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--electric-blue);
        }
        
        .tab-btn {
            background: transparent;
            color: var(--text-color);
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            color: var(--neon-blue);
            border-bottom: 3px solid var(--neon-blue);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .shop-item {
            background: rgba(5, 10, 30, 0.7);
            border: 1px solid var(--electric-blue);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .shop-item-info h3 {
            color: var(--neon-blue);
            margin-bottom: 5px;
            font-family: 'Orbitron', sans-serif;
        }
        
        .shop-item-info p {
            font-size: 0.9rem;
            color: #a0a0ff;
        }
        
        .shop-item-price {
            color: var(--neon-blue);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .completed-habit {
            background: rgba(5, 10, 30, 0.7);
            border: 1px solid var(--electric-blue);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .completed-habit h3 {
            color: var(--neon-blue);
            margin-bottom: 5px;
            font-family: 'Orbitron', sans-serif;
            display: flex;
            justify-content: space-between;
        }
        
        .completed-date {
            font-size: 0.9rem;
            color: #a0a0ff;
        }
        
        .system-points {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }
        
        .points-icon {
            width: 24px;
            height: 24px;
            background-color: var(--neon-blue);
            border-radius: 50%;
            margin-right: 10px;
            position: relative;
        }
        
        .points-icon::after {
            content: "✦";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--dark-blue);
            font-size: 14px;
        }
        
        .points-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--neon-blue);
        }
        
        .use-item-btn {
            background: linear-gradient(to bottom, #00a86b, #007a4f);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .item-tag {
            display: inline-block;
            background: rgba(0, 204, 255, 0.2);
            color: var(--neon-blue);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .achievement-badge {
            display: inline-block;
            background: linear-gradient(45deg, var(--electric-blue), var(--neon-blue));
            color: var(--dark-blue);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .xp-bar {
            height: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 5px 0;
            border: 1px solid var(--electric-blue);
        }
        
        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--electric-blue), var(--neon-blue));
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        
        .daily-complete-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--panel-bg);
            border: 2px solid var(--neon-blue);
            border-radius: 8px;
            padding: 15px;
            z-index: 1001;
            box-shadow: 0 0 20px rgba(0, 204, 255, 0.5);
            display: none;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .daily-complete-text {
            font-size: 1.2rem;
            color: var(--neon-blue);
            font-family: 'Orbitron', sans-serif;
        }
        
        /* New styles for streak system */
        .streak-info {
            display: flex;
            align-items: center;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .streak-fire {
            color: #ff9900;
            margin-right: 5px;
        }
        
        .achievement-unlocked {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--panel-bg);
            border: 2px solid gold;
            border-radius: 8px;
            padding: 15px;
            z-index: 1001;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            display: none;
            animation: slideInLeft 0.5s ease-out;
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .achievement-text {
            font-size: 1rem;
            color: gold;
            font-family: 'Orbitron', sans-serif;
        }
        
        .delete-habit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent; /* Changed from rgba(255, 0, 0, 0.3) */
            border: none;
            color: #ff6666;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px; /* Slightly larger font */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7; /* Make it slightly transparent */
        }

        .delete-habit-btn:hover {
            background: rgba(255, 0, 0, 0.2); /* Lighter background on hover */
            opacity: 1; /* Full opacity on hover */
        }

        .edit-habit-btn {
            position: absolute;
            top: 35px;
            right: 10px;
            background: transparent; /* Changed from rgba(0, 204, 255, 0.3) */
            border: none;
            color: var(--neon-blue);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px; /* Slightly larger font */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7; /* Make it slightly transparent */
        }

        .edit-habit-btn:hover {
            background: rgba(0, 204, 255, 0.2); /* Lighter background on hover */
            opacity: 1; /* Full opacity on hover */
        }
        .combo-meter {
            height: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 5px 0;
            border: 1px solid var(--electric-blue);
            position: relative;
        }
        
        .combo-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9900, #ff5500);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        
        .combo-text {
            font-size: 0.8rem;
            text-align: center;
            color: #ff9900;
        }
        
        .notification-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.95);
            border: 4px solid var(--neon-blue);
            border-radius: 15px;
            padding: 40px 60px;
            text-align: center;
            z-index: 1001;
            box-shadow: 0 0 50px rgba(0, 204, 255, 0.8);
            display: none;
        }
        
        .notification-text {
            font-size: 3rem;
            font-weight: bold;
            color: var(--neon-blue);
            text-shadow: 0 0 30px rgba(0, 204, 255, 0.9);
            animation: pulse 1.5s infinite;
            font-family: 'Orbitron', sans-serif;
        }
        
        .archive-delete-btn {
            background: linear-gradient(to bottom, #ff3333, #cc0000);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 10px;
        }
/* Styles pour le guide des rangs */
.guide-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    background-color: var(--panel-bg);
    border: 1px solid var(--electric-blue);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0, 102, 255, 0.3);
}

.guide-table th, .guide-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid rgba(0, 204, 255, 0.2);
}

.guide-table th {
    background-color: rgba(0, 102, 255, 0.2);
    color: var(--neon-blue);
    font-family: 'Orbitron', sans-serif;
    font-weight: bold;
}

.guide-table tr:last-child td {
    border-bottom: none;
}

.guide-table tr:hover {
    background-color: rgba(0, 102, 255, 0.1);
}
.extra-progress {
    background: rgba(0, 204, 255, 0.1);
    border: 1px solid var(--neon-blue);
    border-radius: 5px;
    padding: 8px;
    margin: 10px 0;
    text-align: center;
}

.extra-progress span {
    color: var(--neon-blue);
    font-weight: bold;
}

.extra-progress small {
    color: #a0a0ff;
    display: block;
    font-size: 0.8rem;
}
.check-btn.completed-btn {
    background: #444 !important;
    cursor: pointer;
}

@media (max-width: 768px) {
    .guide-table {
        display: block;
        overflow-x: auto;
    }
}
/* Animated background elements */
.background-particle {
    position: fixed;
    background: rgba(0, 204, 255, 0.15);
    border-radius: 50%;
    pointer-events: none;
    z-index: -1;
    animation: float 15s infinite linear;
}

.background-particle:nth-child(odd) {
    background: rgba(0, 102, 255, 0.1);
    animation-duration: 20s;
    animation-direction: reverse;
}

.background-particle:nth-child(3n) {
    background: rgba(100, 150, 255, 0.2);
    animation-duration: 25s;
    animation-delay: -5s;
}

@keyframes float {
    0% {
        transform: translate(0, 0) rotate(0deg);
    }
    100% {
        transform: translate(100vw, 100vh) rotate(360deg);
    }
}

/* Glowing orbs */
.background-orb {
    position: fixed;
    border-radius: 50%;
    filter: blur(40px);
    opacity: 0.1;
    z-index: -1;
    animation: pulse-orb 8s infinite ease-in-out;
}

.background-orb:nth-child(2n) {
    animation-delay: -2s;
    animation-duration: 12s;
}

@keyframes pulse-orb {
    0%, 100% {
        transform: scale(1);
        opacity: 0.1;
    }
    50% {
        transform: scale(1.5);
        opacity: 0.15;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Solo Leveling System</h1>
            <p>Level up your levels</p>
        </header>
        
        <div class="notification">
            <p>NOTIFICATION</p>
            <p>You have acquired the qualifications of a player.</p>
        </div>
        
        <div class="system-tabs">
            <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
            <button class="tab-btn" data-tab="shop">System Shop</button>
            <button class="tab-btn" data-tab="hall-of-fame">Hall of Fame</button>
            <button class="tab-btn" data-tab="rank-guide">Guide</button>
        </div>
        
        <div class="tab-content active" id="dashboard-tab">
            <div class="current-level">
                Level <span id="current-level">1</span>
            </div>
            
            <div class="system-points">
                <div class="points-icon"></div>
                <div class="points-value" id="system-points">0</div>
            </div>
            
            <div class="countdown">
                Time remaining: <span id="countdown-timer">No active deadlines</span>
            </div>
            
            <div class="dashboard">
                <div class="stats-panel">
                    <h2>Global Statistics</h2>
                    <div class="stat-item">
                        <div class="stat-label">Current Level</div>
                        <div class="stat-value" id="current-level-value">1</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">System Points</div>
                        <div class="stat-value" id="system-points-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Experience</div>
                        <div class="xp-bar">
                            <div class="xp-fill" id="xp-progress" style="width: 0%;"></div>
                        </div>
                        <div class="stat-value" id="xp-value">0/100</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Global Progress</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="global-progress" style="width: 0%;"></div>
                        </div>
                        <div class="stat-value" id="global-percentage">0%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Completed Habits</div>
                        <div class="stat-value" id="completed-habits">0/0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Consecutive Days</div>
                        <div class="stat-value" id="consecutive-days">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Active Combo</div>
                        <div class="combo-meter">
                            <div class="combo-fill" id="combo-meter-fill" style="width: 0%;"></div>
                        </div>
                        <div class="combo-text" id="combo-text">No active combo</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Active Items</div>
                        <div id="active-items-list">
                            <!-- Active items will appear here -->
                        </div>
                    </div>
                    <button class="btn btn-reset" id="reset-btn">Reset System</button>
                </div>
                
                <div class="habits-panel">
                    <div class="habits-header">
                        <h2>Your Habits</h2>
                        <button class="btn" id="add-habit-btn">+ New Habit</button>
                    </div>
                    
                    <div class="habit-list" id="habits-container">
                        <!-- Habits will be added here dynamically -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="shop-tab">
            <div class="stats-panel">
                <h2>System Shop</h2>
                <div class="system-points">
                    <div class="points-icon"></div>
                    <div class="points-value" id="shop-points">0</div>
                </div>
                
                <div id="shop-items">
                    <!-- Shop items will be sorted by price (cheapest first) -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="hall-of-fame-tab">
            <div class="stats-panel">
                <h2>Hall of Fame</h2>
                <p>Your completed objectives and achievements</p>
                
                <div id="completed-habits-list">
                    <!-- Completed habits will appear here -->
                </div>
                
                <h3 style="margin-top: 20px;">Achievements</h3>
                <div id="achievements-list">
                    <!-- Achievements will appear here -->
                </div>
            </div>
        </div>
        <div class="tab-content" id="rank-guide-tab">
            <div class="stats-panel">
                <h2>Rank Guide</h2>
                <p>Understand the difficulty levels and requirements for each rank</p>
                
                <table class="guide-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Effort Required</th>
                            <th>Daily Time</th>
                            <th>Complexity</th>
                            <th>Example in English</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="habit-rank rank-e">E-Rank</span></td>
                            <td>Minimal</td>
                            <td>≤ 5 min</td>
                            <td>Very Simple</td>
                            <td>Read 2 pages of a book</td>
                        </tr>
                        <tr>
                            <td><span class="habit-rank rank-d">D-Rank</span></td>
                            <td>Light</td>
                            <td>5-15 min</td>
                            <td>Simple</td>
                            <td>Learn 5 vocabulary words</td>
                        </tr>
                        <tr>
                            <td><span class="habit-rank rank-c">C-Rank</span></td>
                            <td>Moderate</td>
                            <td>15-30 min</td>
                            <td>Medium</td>
                            <td>Watch a 15-minute video</td>
                        </tr>
                        <tr>
                            <td><span class="habit-rank rank-b">B-Rank</span></td>
                            <td>High</td>
                            <td>30-60 min</td>
                            <td>High</td>
                            <td>Review 50 vocabulary words</td>
                        </tr>
                        <tr>
                            <td><span class="habit-rank rank-a">A-Rank</span></td>
                            <td>Intense</td>
                            <td>1-2 hours</td>
                            <td>Complex</td>
                            <td>Read 3 articles + take notes</td>
                        </tr>
                        <tr>
                            <td><span class="habit-rank rank-s">S-Rank</span></td>
                            <td>Extreme</td>
                            <td>2+ hours</td>
                            <td>Very Complex</td>
                            <td>Watch 5 videos + review 150 words + read 2 articles</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="modal" id="add-habit-modal">
        <div class="modal-content">
            <h2>New Habit</h2>
            <div class="form-group">
                <label for="habit-name">Habit Name</label>
                <input type="text" id="habit-name" placeholder="Ex: Learn Spanish">
            </div>
            <div class="form-group">
                <label for="habit-rank">Habit Rank</label>
                <select id="habit-rank">
                    <option value="e">E-Rank (Easy)</option>
                    <option value="d">D-Rank</option>
                    <option value="c">C-Rank</option>
                    <option value="b">B-Rank</option>
                    <option value="a">A-Rank</option>
                    <option value="s">S-Rank (Challenging)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="habit-target">Total Target</label>
                <input type="number" id="habit-target" placeholder="Ex: 100 (videos, words, etc.)">
            </div>
            <div class="form-group">
                <label for="daily-goal">Daily Goal</label>
                <input type="number" id="daily-goal" placeholder="Ex: 6 (per day)">
            </div>
            <div class="form-group">
                <label for="habit-frequency">Frequency</label>
                <select id="habit-frequency">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>
            <div class="form-group">
                <label for="habit-deadline">Deadline (optional)</label>
                <input type="date" id="habit-deadline">
            </div>
            <button class="btn" id="save-habit-btn">Create Habit</button>
            <button class="btn" id="close-modal-btn" style="background: #444; margin-left: 10px;">Cancel</button>
        </div>
        
    </div>
    <div class="modal" id="edit-habit-modal">
    <div class="modal-content">
        <h2>Edit Habit</h2>
        <input type="hidden" id="edit-habit-index">
        <div class="form-group">
            <label for="edit-habit-name">Habit Name</label>
            <input type="text" id="edit-habit-name" placeholder="Ex: Learn Spanish">
        </div>
        <div class="form-group">
            <label for="edit-habit-rank">Habit Rank</label>
            <select id="edit-habit-rank">
                <option value="e">E-Rank (Easy)</option>
                <option value="d">D-Rank</option>
                <option value="c">C-Rank</option>
                <option value="b">B-Rank</option>
                <option value="a">A-Rank</option>
                <option value="s">S-Rank (Challenging)</option>
            </select>
        </div>
        <div class="form-group">
            <label for="edit-habit-target">Total Target</label>
            <input type="number" id="edit-habit-target" placeholder="Ex: 100 (videos, words, etc.)">
        </div>
        <div class="form-group">
            <label for="edit-daily-goal">Daily Goal</label>
            <input type="number" id="edit-daily-goal" placeholder="Ex: 6 (per day)">
        </div>
        <div class="form-group">
            <label for="edit-habit-frequency">Frequency</label>
            <select id="edit-habit-frequency">
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
            </select>
        </div>
        <div class="form-group">
            <label for="edit-habit-deadline">Deadline (optional)</label>
            <input type="date" id="edit-habit-deadline">
        </div>
        <button class="btn" id="update-habit-btn">Update Habit</button>
        <button class="btn" id="close-edit-modal-btn" style="background: #444; margin-left: 10px;">Cancel</button>
    </div>
</div>
    <div class="level-up-notification" id="level-up-notification">
        <div class="level-up-text">LEVEL UP!</div>
    </div>
    <div class="level-up-notification" id="all-habits-complete-notification">
        <div class="level-up-text">LEVEL UP!<br>All checked!</div>
    </div>
    <div class="welcome-notification" id="welcome-notification">
        <div class="welcome-text">WELCOME TO THE SYSTEM</div>
    </div>
    
    <div class="daily-complete-notification" id="daily-complete-notification">
        <div class="daily-complete-text"> Goal Complete! +<span id="points-earned">0</span> Points</div>
    </div>
    
    <div class="achievement-unlocked" id="achievement-unlocked">
        <div class="achievement-text">Achievement Unlocked: <span id="achievement-name"></span></div>
    </div>
    
    <div class="notification-popup" id="habit-complete-notification">
        <div class="notification-text">QUEST COMPLETE!</div>
    </div>
    
    <div class="modal" id="item-use-modal">
        <div class="modal-content">
            <h2 id="item-use-title">Use Item</h2>
            <div id="item-use-description">
                <!-- Item description will appear here -->
            </div>
            <div class="form-group" id="item-habit-select-container" style="display: none;">
                <label for="item-habit-select">Select Habit</label>
                <select id="item-habit-select">
                    <!-- Habits will be populated here -->
                </select>
            </div>
            <button class="btn" id="use-item-btn">Use Item</button>
            <button class="btn" id="cancel-item-btn" style="background: #444; margin-left: 10px;">Cancel</button>
        </div>
    </div>
    
    <audio id="level-up-sound" preload="auto">
        <source src="levelup-sound.mp3" type="audio/mpeg">
    </audio>

    <audio id="all-complete-sound" preload="auto">
        <source src="levelup-sound.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="welcome-sound" preload="auto">
    <source src="welcome-sound.mp3" type="audio/mpeg">
    </audio>

    <audio id="points-sound" preload="auto">
        <source src="points-sound.mp3" type="audio/mpeg">
    </audio>
    <audio id="complete-sound" preload="auto">
        <source src="complete-sound.mp3" type="audio/mpeg">
    </audio>
    <audio id="achievement-sound" preload="auto">
        <source src="achievement-sound.mp3" type="audio/mpeg">
    </audio>
    <audio id="notification-sound" preload="auto">
        <source src="notification-sound.mp3" type="audio/mpeg">
    </audio>
    <audio id="click-sound" preload="auto">
        <source src="click-sound.mp3" type="audio/mpeg">
    </audio>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const habitsContainer = document.getElementById('habits-container');
            const addHabitBtn = document.getElementById('add-habit-btn');
            const editHabitModal = document.getElementById('edit-habit-modal');
            const updateHabitBtn = document.getElementById('update-habit-btn');
            const closeEditModalBtn = document.getElementById('close-edit-modal-btn');
            const addHabitModal = document.getElementById('add-habit-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const saveHabitBtn = document.getElementById('save-habit-btn');
            const resetBtn = document.getElementById('reset-btn');
            const levelUpNotification = document.getElementById('level-up-notification');
            const welcomeNotification = document.getElementById('welcome-notification');
            const dailyCompleteNotification = document.getElementById('daily-complete-notification');
            const achievementUnlocked = document.getElementById('achievement-unlocked');
            const habitCompleteNotification = document.getElementById('habit-complete-notification');
            const itemUseModal = document.getElementById('item-use-modal');
            const useItemBtn = document.getElementById('use-item-btn');
            const cancelItemBtn = document.getElementById('cancel-item-btn');
            const shopItemsContainer = document.getElementById('shop-items');
            
            // Audio elements
            const levelUpSound = document.getElementById('level-up-sound');
            const welcomeSound = document.getElementById('welcome-sound');
            const pointsSound = document.getElementById('points-sound');
            const completeSound = document.getElementById('complete-sound');
            const achievementSound = document.getElementById('achievement-sound');
            const notificationSound = document.getElementById('notification-sound');
            const clickSound = document.getElementById('click-sound');
            
            // Tab functionality
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    
                    // Update active tab button
                    tabBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Show active tab content
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Initialize app state
            let state = {
                level: 1,
                xp: 0,
                xpToNextLevel: 100,
                systemPoints: 0,
                habits: [],
                completedHabits: [],
                achievements: [],
                activeItems: [],
                consecutiveDays: 0,
                lastCompletedDate: null,    // This will store a timestamp
                lastResetDate: null,        // This will store a timestamp
                lastExtraProgressApply: null, // This will store a timestamp
                comboMeter: 0,
                comboMultiplier: 1
            };
            // Load state from localStorage if available
            if (localStorage.getItem('soloLevelingState')) {
                state = JSON.parse(localStorage.getItem('soloLevelingState'));
                checkForMissedDaysOnLoad(); // Add this line
            }

            // Show welcome notification on every page load
            setTimeout(() => {
                welcomeNotification.style.display = 'block';
                
                // Play welcome sound with user interaction workaround
                const playWelcomeSound = () => {
                    welcomeSound.play().catch(e => {
                        console.log("Audio play failed:", e);
                    });
                    document.body.removeEventListener('click', playWelcomeSound);
                };
                
                // Add click event listener to enable audio playback
                document.body.addEventListener('click', playWelcomeSound);
                
                setTimeout(() => {
                    welcomeNotification.style.display = 'none';
                }, 3000);
            }, 1000);
            
            // Update UI regardless of whether state was loaded
            updateUI();
            // Save state to localStorage
            function saveState() {
                localStorage.setItem('soloLevelingState', JSON.stringify(state));
            }
            
            // Update UI with current state
            function updateUI() {
                // Update stats
                document.getElementById('current-level').textContent = state.level;
                document.getElementById('current-level-value').textContent = state.level;
                document.getElementById('system-points').textContent = state.systemPoints;
                document.getElementById('system-points-value').textContent = state.systemPoints;
                document.getElementById('shop-points').textContent = state.systemPoints;
                
                // Update XP bar
                const xpPercentage = (state.xp / state.xpToNextLevel) * 100;
                document.getElementById('xp-progress').style.width = `${xpPercentage}%`;
                document.getElementById('xp-value').textContent = `${state.xp}/${state.xpToNextLevel}`;
                
                // Update global progress
                const totalProgress = calculateGlobalProgress();
                document.getElementById('global-progress').style.width = `${totalProgress}%`;
                document.getElementById('global-percentage').textContent = `${Math.round(totalProgress)}%`;
                
                // Update completed habits
                const completedCount = state.habits.filter(h => h.completedToday).length;
                document.getElementById('completed-habits').textContent = `${completedCount}/${state.habits.length}`;
                
                // Update consecutive days
                document.getElementById('consecutive-days').textContent = state.consecutiveDays;
                
                // Update combo meter
                document.getElementById('combo-meter-fill').style.width = `${state.comboMeter}%`;
                document.getElementById('combo-text').textContent = state.consecutiveDays >= 3 ? 
                    `Combo x${state.comboMultiplier} (${state.consecutiveDays} days)` : 'No active combo';
                
                // Render habits
                renderHabits();
                
                // Update countdown timer
                updateCountdownTimer();
                
                // Update shop
                renderShopItems();
                
                // Update active items
                renderActiveItems();
                
                // Update hall of fame
                renderCompletedHabits();
                renderAchievements();
            }
            
            // Calculate global progress across all habits
            function calculateGlobalProgress() {
                if (state.habits.length === 0) return 0;
                
                let totalProgress = 0;
                state.habits.forEach(habit => {
                    const habitProgress = (habit.current / habit.target) * 100;
                    totalProgress += habitProgress;
                });
                
                return totalProgress / state.habits.length;
            }
                        // Open edit modal with habit data
            function openEditModal(index) {
                const habit = state.habits[index];
                
                document.getElementById('edit-habit-index').value = index;
                document.getElementById('edit-habit-name').value = habit.name;
                document.getElementById('edit-habit-rank').value = habit.rank;
                document.getElementById('edit-habit-target').value = habit.target;
                document.getElementById('edit-daily-goal').value = habit.dailyGoal;
                document.getElementById('edit-habit-deadline').value = habit.deadline || '';
                document.getElementById('edit-habit-frequency').value = habit.frequency || 'daily';
                
                editHabitModal.style.display = 'flex';
            }

            // Update habit with new data
            function updateHabit() {
                const index = parseInt(document.getElementById('edit-habit-index').value);
                const name = document.getElementById('edit-habit-name').value;
                const rank = document.getElementById('edit-habit-rank').value;
                const target = parseInt(document.getElementById('edit-habit-target').value);
                const dailyGoal = parseInt(document.getElementById('edit-daily-goal').value);
                const deadline = document.getElementById('edit-habit-deadline').value;
                const frequency = document.getElementById('edit-habit-frequency').value;
                
                if (!name || !target || !dailyGoal) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                if (dailyGoal <= 0) {
                    alert('Daily goal must be greater than 0');
                    return;
                }
                
                // Update the habit
                state.habits[index] = {
                    ...state.habits[index],
                    name,
                    rank,
                    target,
                    dailyGoal,
                    frequency: frequency,  // Add this line
                    deadline: deadline || null
                };
                
                editHabitModal.style.display = 'none';
                saveState();
                updateUI();
            }
            // Render all habits
            function renderHabits() {
                habitsContainer.innerHTML = '';
                
                if (state.habits.length === 0) {
                    habitsContainer.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                            <h3 style="color: var(--neon-blue); margin-bottom: 20px;">No Habits Yet</h3>
                            <p style="margin-bottom: 20px;">Create your first habit to start your journey!</p>
                            <button class="btn" id="create-first-habit-btn">Create First Habit</button>
                        </div>
                    `;
                    
                    document.getElementById('create-first-habit-btn').addEventListener('click', () => {
                        addHabitModal.style.display = 'flex';
                    });
                    
                    return;
                }
                
                state.habits.forEach((habit, index) => {
                    const habitCard = document.createElement('div');
                    habitCard.className = 'habit-card';
                    
                    const progressPercentage = (habit.current / habit.target) * 100;
                    const dailyProgressPercentage = (habit.dailyProgress / habit.dailyGoal) * 100;
                    
                    // Calculate days remaining if deadline exists
                    let daysRemainingText = '';
                    if (habit.deadline) {
                        const today = new Date();
                        const deadline = new Date(habit.deadline);
                        const timeDiff = deadline.getTime() - today.getTime();
                        const daysRemaining = Math.ceil(timeDiff / (1000 * 3600 * 24));
                        
                        if (daysRemaining < 0) {
                            daysRemainingText = `<span style="color: #ff5555;">Deadline passed!</span>`;
                        } else {
                            daysRemainingText = `${daysRemaining} days remaining`;
                        }
                    }
                    
                    habitCard.innerHTML = `
                        <button class="delete-habit-btn" data-index="${index}">✕</button>
                        <button class="edit-habit-btn" data-index="${index}">✎</button>
                        <div class="habit-title">
                            <span>${habit.name}</span>
                            <span class="habit-rank rank-${habit.rank}">${habit.rank.toUpperCase()}-Rank</span>
                        </div>
                        <div class="habit-info">
                            <span>Progress: ${habit.current}/${habit.target}</span>
                            <span>${daysRemainingText}</span>
                        </div>
                        <div class="habit-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%;"></div>
                            </div>
                        </div>
                        <div class="daily-goal">
                            <span>
                                ${habit.frequency === 'daily' ? 'Today' : habit.frequency === 'weekly' ? 'This Week' : 'This Month'}: 
                                ${habit.dailyProgress}/${habit.dailyGoal}
                            </span>
                            <div class="daily-progress">
                                ${Array.from({length: habit.dailyGoal}, (_, i) => 
                                    `<div class="daily-point ${i < habit.dailyProgress ? 'completed' : ''}"></div>`
                                ).join('')}
                            </div>
                        </div>
                        ${habit.extraProgress > 0 ? `
                        <div class="extra-progress">
                            <span>Extra progress: ${habit.extraProgress}</span>
                            <small>Will be applied to future days</small>
                        </div>
                        ` : ''}
                        <div class="habit-actions">
                            <button class="check-btn ${habit.dailyProgress >= habit.dailyGoal ? 'completed-btn' : ''}" data-index="${index}">+1</button>
                            <div class="streak-info">
                                <span class="streak-fire">🔥</span>
                                <span>${habit.consecutiveDays || 0} days</span>
                            </div>
                        </div>
                    `;
                    
                    habitsContainer.appendChild(habitCard);
                });
                
                // Add event listeners to check buttons
                document.querySelectorAll('.check-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        incrementHabitProgress(index);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-habit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        deleteHabit(index);
                    });
                });
                                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-habit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        openEditModal(index);
                    });
                });
            }
            
            // Render shop items
            function renderShopItems() {
                shopItemsContainer.innerHTML = '';
                
                const shopItems = [
                    {
                        id: 'double-points',
                        name: 'Double Points (1 day)',
                        description: 'Double points earned from all habits for 24 hours',
                        price: 500,
                        type: 'buff'
                    },
                    {
                        id: 'xp-boost',
                        name: 'XP Boost (1 day)',
                        description: 'Earn 50% more XP from all habits for 24 hours',
                        price: 400,
                        type: 'buff'
                    },
                    {
                        id: 'daily-goal-reset',
                        name: 'Daily Goal Reset',
                        description: 'Reset daily goals for all habits (useful if you missed a day)',
                        price: 300,
                        type: 'utility'
                    },
                    {
                        id: 'streak-protector',
                        name: 'Streak Protector',
                        description: 'Protect your streak for one habit for 7 days (even if you miss a day)',
                        price: 700,
                        type: 'buff'
                    },
                    {
                        id: 'instant-daily',
                        name: 'Instant Daily Complete',
                        description: 'Instantly complete daily goal for one habit',
                        price: 250,
                        type: 'utility'
                    },
                    {
                        id: 'level-up',
                        name: 'Level Up Manual',
                        description: 'Instantly gain one level',
                        price: 2000,
                        type: 'consumable'
                    }
                ];
                
                // Sort shop items by price (cheapest first)
                shopItems.sort((a, b) => a.price - b.price);
                
                shopItems.forEach(item => {
                    const shopItem = document.createElement('div');
                    shopItem.className = 'shop-item';
                    
                    shopItem.innerHTML = `
                        <div class="shop-item-info">
                            <h3>${item.name} <span class="item-tag">${item.type}</span></h3>
                            <p>${item.description}</p>
                        </div>
                        <div class="shop-item-actions">
                            <div class="shop-item-price">${item.price} pts</div>
                            <button class="btn use-item-btn" data-id="${item.id}" data-price="${item.price}" 
                                ${state.systemPoints < item.price ? 'disabled' : ''}>Buy</button>
                        </div>
                    `;
                    
                    shopItemsContainer.appendChild(shopItem);
                });
                
                // Add event listeners to buy buttons
                document.querySelectorAll('.use-item-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const itemId = this.getAttribute('data-id');
                        const itemPrice = parseInt(this.getAttribute('data-price'));
                        
                        if (state.systemPoints >= itemPrice) {
                            buyItem(itemId, itemPrice);
                        }
                    });
                });
                // Add sound to buy buttons
                document.querySelectorAll('.use-item-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        // Play the click sound when any buy button is clicked
                        clickSound.play().catch(e => {
                            console.log("Audio play failed:", e);
                        });
                    });
                });
            }
            
            // Render active items
            function renderActiveItems() {
                const activeItemsList = document.getElementById('active-items-list');
                activeItemsList.innerHTML = '';
                
                if (state.activeItems.length === 0) {
                    activeItemsList.innerHTML = '<p>No active items</p>';
                    return;
                }
                
                state.activeItems.forEach((item, index) => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'active-item';
                    itemEl.innerHTML = `
                        <p>${item.name} (Expires: ${new Date(item.expires).toLocaleDateString()})</p>
                    `;
                    activeItemsList.appendChild(itemEl);
                });
            }
            
            // Render completed habits
            function renderCompletedHabits() {
                const completedHabitsList = document.getElementById('completed-habits-list');
                completedHabitsList.innerHTML = '';
                
                if (state.completedHabits.length === 0) {
                    completedHabitsList.innerHTML = '<p>No completed habits yet</p>';
                    return;
                }
                
                state.completedHabits.forEach(habit => {
                    const habitEl = document.createElement('div');
                    habitEl.className = 'completed-habit';
                    
                    habitEl.innerHTML = `
                        <h3>${habit.name} <span class="achievement-badge">Completed</span></h3>
                        <p class="completed-date">Completed on: ${new Date(habit.completedOn).toLocaleDateString()}</p>
                        <p>Streak: ${habit.consecutiveDays || 0} days</p>
                        <div>
                            <button class="btn use-item-btn" style="margin-right: 5px;" data-id="${habit.id}" data-action="reactivate">Reactivate</button>
                            <button class="archive-delete-btn" data-id="${habit.id}">Remove</button>
                        </div>
                    `;
                    
                    completedHabitsList.appendChild(habitEl);
                });
                
                // Add event listeners to archive buttons
                document.querySelectorAll('.archive-delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const habitId = this.getAttribute('data-id');
                        removeFromArchive(habitId);
                    });
                });

                // Add event listeners to reactivate buttons
                document.querySelectorAll('.use-item-btn[data-action="reactivate"]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const habitId = this.getAttribute('data-id');
                        reactivateHabit(habitId);
                    });
                });
            }
            
            // Render achievements
            function renderAchievements() {
                const achievementsList = document.getElementById('achievements-list');
                achievementsList.innerHTML = '';
                
                if (state.achievements.length === 0) {
                    achievementsList.innerHTML = '<p>No achievements unlocked yet</p>';
                    return;
                }
                
                state.achievements.forEach(achievement => {
                    const achievementEl = document.createElement('div');
                    achievementEl.className = 'completed-habit';
                    
                    achievementEl.innerHTML = `
                        <h3>${achievement.name} <span class="achievement-badge">Achievement</span></h3>
                        <p class="completed-date">Unlocked on: ${new Date(achievement.unlockedOn).toLocaleDateString()}</p>
                        <p>${achievement.description}</p>
                    `;
                    
                    achievementsList.appendChild(achievementEl);
                });
            }
            
            // Update countdown timer based on furthest deadline
            function updateCountdownTimer() {
                const countdownTimer = document.getElementById('countdown-timer');
                let furthestDeadline = null;
                
                // Find the furthest deadline among all habits
                state.habits.forEach(habit => {
                    if (habit.deadline) {
                        const deadline = new Date(habit.deadline);
                        if (!furthestDeadline || deadline > furthestDeadline) {
                            furthestDeadline = deadline;
                        }
                    }
                });
                
                if (!furthestDeadline) {
                    countdownTimer.textContent = 'No active deadlines';
                    return;
                }
                
                // Update countdown every second
                const updateTimer = () => {
                    const now = new Date();
                    const timeRemaining = furthestDeadline - now;
                    
                    if (timeRemaining <= 0) {
                        countdownTimer.textContent = 'Deadline passed!';
                        return;
                    }
                    
                    const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
                    
                    countdownTimer.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                };
                
                updateTimer();
                setInterval(updateTimer, 1000);
            }
            
            // Increment habit progress
            function incrementHabitProgress(index) {
                const habit = state.habits[index];
                
                // Play sound
                clickSound.play();
                
                habit.dailyProgress++;
                habit.current++;
                
                // Check if daily goal is completed
                if (habit.dailyProgress >= habit.dailyGoal) {
                    // Calculate any extra progress beyond daily goal
                    habit.extraProgress = Math.max(0, habit.dailyProgress - habit.dailyGoal);
                    completeDailyGoal(habit);
                }
                
                // Check if all habits are completed today
                if (checkAllHabitsCompleted()) {
                    showAllHabitsCompleteNotification();
                }
                
                // Check if habit is fully completed
                if (habit.current >= habit.target) {
                    completeHabit(index);
                }
                
                saveState();
                updateUI();
            }
            
            // Complete daily goal
            function completeDailyGoal(habit) {
                habit.streakHistory = habit.streakHistory || [];
                // Calculate points based on rank with increased difficulty
                const rankMultipliers = {
                    'e': 5,
                    'd': 10,
                    'c': 20,
                    'b': 35,
                    'a': 50,
                    's': 75
                };
                
                // Apply combo multiplier for consecutive days
                const basePoints = rankMultipliers[habit.rank] || 10;
                const pointsEarned = Math.floor(basePoints * state.comboMultiplier);
                
                // Add points
                state.systemPoints += pointsEarned;
                
                // Add XP based on rank with increased difficulty
                const xpMultipliers = {
                    'e': 5,
                    'd': 10,
                    'c': 15,
                    'b': 25,
                    'a': 40,
                    's': 60
                };
                
                const xpEarned = xpMultipliers[habit.rank] || 10;
                addXP(xpEarned);
                
                // Update streak - This is the important line!
                updateStreak();
                habit.consecutiveDays = (habit.consecutiveDays || 0) + 1;
                // Show notification
                document.getElementById('points-earned').textContent = pointsEarned;
                dailyCompleteNotification.style.display = 'block';
                pointsSound.play();
                
                setTimeout(() => {
                    dailyCompleteNotification.style.display = 'none';
                }, 3000);
                
                // Check for achievements
                checkForAchievements();
            }
            
            // Complete habit
            function completeHabit(index) {
                const habit = state.habits[index];
                
                // Move to completed habits (store all relevant data for reactivation)
                state.completedHabits.push({
                    id: Date.now(),
                    name: habit.name,
                    rank: habit.rank,
                    target: habit.target,
                    dailyGoal: habit.dailyGoal,
                    frequency: habit.frequency,
                    deadline: habit.deadline,
                    consecutiveDays: habit.consecutiveDays || 0, // Store streak
                    streakHistory: habit.streakHistory || [], // Store streak history
                    completedOn: new Date().getTime() // Store as timestamp
                });
                                                
                // Remove from active habits
                state.habits.splice(index, 1);
                
                // Show notification
                habitCompleteNotification.style.display = 'block';
                completeSound.play();
                
                setTimeout(() => {
                    habitCompleteNotification.style.display = 'none';
                }, 3000);
                
                // Check for achievements
                checkForAchievements();
            }
            
            // Add XP and check for level up
            function addXP(amount) {
                state.xp += amount;
                
                while (state.xp >= state.xpToNextLevel) {
                    state.xp -= state.xpToNextLevel;
                    state.level++;
                    
                    // Increase XP needed for next level (more gradual progression)
                    state.xpToNextLevel = Math.floor(state.xpToNextLevel * 1.3); // Increased from 1.2
                    
                    // Show level up notification
                    levelUpNotification.style.display = 'block';
                    levelUpSound.play();
                    
                    setTimeout(() => {
                        levelUpNotification.style.display = 'none';
                    }, 3000);
                }
            }
            
            // Update streak and combo system
            // Update streak and combo system
            function updateStreak() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // Check if any habit was completed today
                const anyHabitCompletedToday = state.habits.some(habit => habit.dailyProgress >= habit.dailyGoal);
                
                if (!anyHabitCompletedToday) {
                    // No habits completed today, don't update streak
                    return;
                }
                
                // If we haven't tracked any completion yet, start today
                if (!state.lastCompletedDate) {
                    state.consecutiveDays = 1;
                    state.lastCompletedDate = today.getTime();
                    updateComboMeter();
                    return;
                }
                
                const lastCompleted = new Date(state.lastCompletedDate);
                lastCompleted.setHours(0, 0, 0, 0);
                
                const daysSinceLastCompletion = Math.floor((today - lastCompleted) / (1000 * 60 * 60 * 24));
                
                if (daysSinceLastCompletion === 0) {
                    // Already completed today
                    return;
                } else if (daysSinceLastCompletion === 1) {
                    // Consecutive day
                    state.consecutiveDays++;
                    updateComboMeter();
                } else if (daysSinceLastCompletion > 1) {
                    // Broken streak (missed one or more days)
                    state.consecutiveDays = 1;
                    state.comboMeter = Math.max(0, state.comboMeter - 30);
                    updateComboMultiplier();
                }
                
                state.lastCompletedDate = today.getTime();
            }

            function updateComboMeter() {
                if (state.consecutiveDays >= 3) {
                    state.comboMeter = Math.min(100, state.comboMeter + 10);
                    updateComboMultiplier();
                }
            }

            function updateComboMultiplier() {
                if (state.comboMeter >= 100) state.comboMultiplier = 3;
                else if (state.comboMeter >= 75) state.comboMultiplier = 2.5;
                else if (state.comboMeter >= 50) state.comboMultiplier = 2;
                else if (state.comboMeter >= 25) state.comboMultiplier = 1.5;
                else state.comboMultiplier = 1;
            }
            
            // Check for achievements
            function checkForAchievements() {
                const achievements = [
                    {
                        id: 'first_habit',
                        name: 'First Steps',
                        description: 'Complete your first daily goal',
                        condition: () => state.completedHabits.length + state.habits.filter(h => h.dailyProgress > 0).length >= 1,
                        unlocked: false
                    },
                    {
                        id: 'streak_3',
                        name: 'Consistency',
                        description: 'Maintain a 3-day streak',
                        condition: () => state.consecutiveDays >= 3,
                        unlocked: false
                    },
                    {
                        id: 'streak_7',
                        name: 'Dedication',
                        description: 'Maintain a 7-day streak',
                        condition: () => state.consecutiveDays >= 7,
                        unlocked: false
                    },
                    {
                        id: 'streak_30',
                        name: 'Unstoppable',
                        description: 'Maintain a 30-day streak',
                        condition: () => state.consecutiveDays >= 30,
                        unlocked: false
                    },
                    {
                        id: 'level_5',
                        name: 'Rising Star',
                        description: 'Reach level 5',
                        condition: () => state.level >= 5,
                        unlocked: false
                    },
                    {
                        id: 'level_10',
                        name: 'Seasoned Hunter',
                        description: 'Reach level 10',
                        condition: () => state.level >= 10,
                        unlocked: false
                    },
                    {
                        id: 'level_20',
                        name: 'Elite',
                        description: 'Reach level 20',
                        condition: () => state.level >= 20,
                        unlocked: false
                    },
                    {
                        id: 'complete_3',
                        name: 'Triple Threat',
                        description: 'Complete 3 habits',
                        condition: () => state.completedHabits.length >= 3,
                        unlocked: false
                    },
                    {
                        id: 'complete_10',
                        name: 'Habit Master',
                        description: 'Complete 10 habits',
                        condition: () => state.completedHabits.length >= 10,
                        unlocked: false
                    },
                    {
                        id: 'combo_max',
                        name: 'Perfect Rhythm',
                        description: 'Reach maximum combo multiplier',
                        condition: () => state.comboMultiplier >= 3,
                        unlocked: false
                    }
                ];
                
                let newAchievement = null;
                
                achievements.forEach(achievement => {
                    // Skip if already unlocked
                    if (state.achievements.find(a => a.id === achievement.id)) {
                        return;
                    }
                    
                    if (achievement.condition()) {
                        achievement.unlocked = true;
                        achievement.unlockedOn = new Date().toISOString();
                        state.achievements.push(achievement);
                        
                        if (!newAchievement) {
                            newAchievement = achievement;
                        }
                    }
                });
                
                // Show notification for new achievement
                if (newAchievement) {
                    document.getElementById('achievement-name').textContent = newAchievement.name;
                    achievementUnlocked.style.display = 'block';
                    achievementSound.play();
                    
                    setTimeout(() => {
                        achievementUnlocked.style.display = 'none';
                    }, 3000);
                }
            }
            
            // Buy item from shop
            function buyItem(itemId, price) {
                const itemMap = {
                    'double-points': {
                        name: 'Double Points',
                        duration: 24 * 60 * 60 * 1000 // 24 hours
                    },
                    'xp-boost': {
                        name: 'XP Boost',
                        duration: 24 * 60 * 60 * 1000 // 24 hours
                    },
                    'daily-goal-reset': {
                        name: 'Daily Goal Reset',
                        instant: true
                    },
                    'streak-protector': {
                        name: 'Streak Protector',
                        duration: 7 * 24 * 60 * 60 * 1000 // 7 days
                    },
                    'instant-daily': {
                        name: 'Instant Daily Complete',
                        instant: true
                    },
                    'level-up': {
                        name: 'Level Up Manual',
                        instant: true
                    }
                };
                
                const item = itemMap[itemId];
                
                if (item.instant) {
                    // Handle instant use items
                    if (itemId === 'daily-goal-reset') {
                        // Reset all daily goals
                        state.habits.forEach(habit => {
                            habit.dailyProgress = 0;
                        });
                        
                        notificationSound.play();
                        alert('All daily goals have been reset!');
                    } else if (itemId === 'instant-daily') {
                        // Show habit selection for instant daily complete
                        const habitSelect = document.getElementById('item-habit-select');
                        habitSelect.innerHTML = '';
                        
                        state.habits.forEach((habit, index) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = habit.name;
                            habitSelect.appendChild(option);
                        });
                        
                        document.getElementById('item-use-title').textContent = 'Instant Daily Complete';
                        document.getElementById('item-use-description').innerHTML = `
                            <p>Select a habit to instantly complete its daily goal:</p>
                        `;
                        document.getElementById('item-habit-select-container').style.display = 'block';
                        
                        itemUseModal.style.display = 'flex';
                        
                        useItemBtn.onclick = function() {
                            const selectedIndex = parseInt(habitSelect.value);
                            const habit = state.habits[selectedIndex];
                            
                            habit.dailyProgress = habit.dailyGoal;
                            habit.current += habit.dailyGoal;
                            
                            completeDailyGoal(habit);
                            
                            // Check if habit is fully completed
                            if (habit.current >= habit.target) {
                                completeHabit(selectedIndex);
                            }
                            
                            state.systemPoints -= price;
                            saveState();
                            updateUI();
                            
                            itemUseModal.style.display = 'none';
                        };
                        
                        return;
                    } else if (itemId === 'level-up') {
                        // Instant level up
                        state.level++;
                        state.xp = 0;
                        state.xpToNextLevel = Math.floor(state.xpToNextLevel * 1.3);
                        
                        levelUpNotification.style.display = 'block';
                        levelUpSound.play();
                        
                        setTimeout(() => {
                            levelUpNotification.style.display = 'none';
                        }, 3000);
                    }
                } else {
                    // Add timed item to active items
                    state.activeItems.push({
                        id: itemId,
                        name: item.name,
                        expires: new Date(Date.now() + item.duration).toISOString()
                    });
                }
                
                // Deduct points
                state.systemPoints -= price;
                
                saveState();
                updateUI();
            }
            
            // Delete habit
            function deleteHabit(index) {
                if (confirm('Are you sure you want to delete this habit? This action cannot be undone.')) {
                    state.habits.splice(index, 1);
                    saveState();
                    updateUI();
                }
            }
            
            // Remove from archive
            function removeFromArchive(habitId) {
                state.completedHabits = state.completedHabits.filter(h => h.id !== parseInt(habitId));
                saveState();
                updateUI();
            }
            // Reactivate habit
            function reactivateHabit(habitId) {
                const habitIndex = state.completedHabits.findIndex(h => h.id === parseInt(habitId));
                if (habitIndex !== -1) {
                    const habit = state.completedHabits[habitIndex];
                    
                    // Move back to active habits with reset progress but keep streak
                    state.habits.push({
                        name: habit.name,
                        rank: habit.rank,
                        target: habit.target || 100, // Default if not stored
                        current: 0,
                        dailyGoal: habit.dailyGoal || 5, // Default if not stored
                        dailyProgress: 0,
                        extraProgress: 0,
                        frequency: habit.frequency || 'daily', // Default if not stored
                        deadline: habit.deadline || null,
                        consecutiveDays: habit.consecutiveDays || 0, // Keep the streak
                        streakHistory: habit.streakHistory || [] // Preserve streak history if it exists
                    });
                    
                    // Remove from completed habits
                    state.completedHabits.splice(habitIndex, 1);
                    
                    saveState();
                    updateUI();
                }
            }
            // Reset system
            resetBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to reset the system? All your progress will be lost.')) {
                    state = {
                        level: 1,
                        xp: 0,
                        xpToNextLevel: 100,
                        systemPoints: 0,
                        habits: [],
                        completedHabits: [],
                        achievements: [],
                        activeItems: [],
                        consecutiveDays: 0,
                        lastCompletedDate: null,
                        comboMeter: 0,
                        comboMultiplier: 1
                    };
                    
                    saveState();
                    updateUI();
                }
            });
            
            // Modal functionality
            addHabitBtn.addEventListener('click', function() {
                addHabitModal.style.display = 'flex';
            });
            
            closeModalBtn.addEventListener('click', function() {
                addHabitModal.style.display = 'none';
            });
            
            cancelItemBtn.addEventListener('click', function() {
                itemUseModal.style.display = 'none';
            });
                        // Edit modal functionality
            updateHabitBtn.addEventListener('click', updateHabit);

            closeEditModalBtn.addEventListener('click', function() {
                editHabitModal.style.display = 'none';
            });
            saveHabitBtn.addEventListener('click', function() {
                const name = document.getElementById('habit-name').value;
                const rank = document.getElementById('habit-rank').value;
                const target = parseInt(document.getElementById('habit-target').value);
                const dailyGoal = parseInt(document.getElementById('daily-goal').value);
                const deadline = document.getElementById('habit-deadline').value;
                const frequency = document.getElementById('habit-frequency').value;
                
                if (!name || !target || !dailyGoal) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                if (dailyGoal <= 0) {
                    alert('Daily goal must be greater than 0');
                    return;
                }
                
                state.habits.push({
                    name,
                    rank,
                    target,
                    current: 0,
                    dailyGoal,
                    dailyProgress: 0,
                    extraProgress: 0,
                    frequency: frequency,  // Add this line
                    deadline: deadline || null,
                    streak: 0
                });
                
                addHabitModal.style.display = 'none';
                saveState();
                updateUI();
                
                // Reset form
                document.getElementById('habit-name').value = '';
                document.getElementById('habit-target').value = '';
                document.getElementById('daily-goal').value = '';
                document.getElementById('habit-deadline').value = '';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === addHabitModal) {
                    addHabitModal.style.display = 'none';
                }
                if (event.target === itemUseModal) {
                    itemUseModal.style.display = 'none';
                }
                if (event.target === editHabitModal) {
                    editHabitModal.style.display = 'none';
                }
            });
            
            // Check for expired items every minute
            setInterval(() => {
                const now = new Date();
                let needsUpdate = false;
                
                state.activeItems = state.activeItems.filter(item => {
                    if (new Date(item.expires) > now) {
                        return true;
                    } else {
                        needsUpdate = true;
                        return false;
                    }
                });
                
                if (needsUpdate) {
                    saveState();
                    updateUI();
                }
            }, 60000);
                        // Vérifier si toutes les habitudes sont complétées aujourd'hui
            function checkAllHabitsCompleted() {
                if (state.habits.length === 0) return false;
                
                return state.habits.every(habit => habit.dailyProgress >= habit.dailyGoal);
            }
            
            // Afficher la notification de toutes les habitudes complétées
            function showAllHabitsCompleteNotification() {
                const notification = document.getElementById('all-habits-complete-notification');
                const sound = document.getElementById('all-complete-sound');
                
                notification.style.display = 'block';
                sound.play();
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            // Add this function to handle applying extra progress
            function applyExtraProgress() {
                const today = new Date();
                today.setHours(0, 0, 0, 0); // Normalize to start of day
                
                // Only apply extra progress once per day
                if (state.lastExtraProgressApply && new Date(state.lastExtraProgressApply).setHours(0,0,0,0) === today.getTime()) {
                    return;
                }
                
                state.habits.forEach(habit => {
                    if (habit.extraProgress > 0) {
                        // Apply extra progress to today's goal
                        habit.dailyProgress = Math.min(habit.dailyGoal, habit.extraProgress);
                        habit.extraProgress = Math.max(0, habit.extraProgress - habit.dailyGoal);
                    }
                });
                
                state.lastExtraProgressApply = today.getTime();
                saveState();
            }
            
            // Add this function to handle daily resets
            function dailyReset() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // Check if we've already done the reset today
                if (state.lastResetDate && new Date(state.lastResetDate).setHours(0,0,0,0) === today.getTime()) {
                    return;
                }
                
                // Check if user completed any habits yesterday to maintain streak
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (state.lastCompletedDate && new Date(state.lastCompletedDate).setHours(0,0,0,0) < yesterday.getTime()) {
                    // User missed a day, reduce combo meter
                    state.comboMeter = Math.max(0, state.comboMeter - 30);
                    updateComboMultiplier();
                }
                
                // Apply any extra progress from previous days
                applyExtraProgress();
                
                // Reset progress based on frequency
                state.habits.forEach(habit => {
                    if (habit.frequency === 'daily') {
                        habit.dailyProgress = 0;
                    } else if (habit.frequency === 'weekly' && today.getDay() === 1) { // Monday
                        habit.dailyProgress = 0;
                    } else if (habit.frequency === 'monthly' && today.getDate() === 1) { // First day of month
                        habit.dailyProgress = 0;
                    }
                });
                
                state.lastResetDate = today.getTime();
                saveState();
                updateUI();
            }
            
            // Set up daily reset check
            setInterval(dailyReset, 60000); // Check every minute
            dailyReset(); // Run on initial load
            function checkForMissedDaysOnLoad() {
                if (!state.lastCompletedDate) return;
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const lastCompleted = new Date(state.lastCompletedDate);
                lastCompleted.setHours(0, 0, 0, 0);
                
                const daysSinceLastCompletion = Math.floor((today - lastCompleted) / (1000 * 60 * 60 * 24));
                
                if (daysSinceLastCompletion > 1) {
                    // User missed one or more days
                    state.consecutiveDays = 1;
                    state.comboMeter = Math.max(0, state.comboMeter - (30 * (daysSinceLastCompletion - 1)));
                    updateComboMultiplier();
                    saveState();
                }
            }
            // Initialize UI
            updateUI();
        });
                    // Create animated background elements
            function createAnimatedBackground() {
                const body = document.body;
                
                // Create floating particles
                for (let i = 0; i < 15; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('background-particle');
                    
                    // Random size and position
                    const size = Math.random() * 20 + 5;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${Math.random() * 100}vw`;
                    particle.style.top = `${Math.random() * 100}vh`;
                    particle.style.animationDelay = `${Math.random() * 5}s`;
                    
                    body.appendChild(particle);
                }
                
                // Create glowing orbs
                for (let i = 0; i < 4; i++) {
                    const orb = document.createElement('div');
                    orb.classList.add('background-orb');
                    
                    // Random size, position and color
                    const size = Math.random() * 300 + 100;
                    orb.style.width = `${size}px`;
                    orb.style.height = `${size}px`;
                    orb.style.left = `${Math.random() * 100}vw`;
                    orb.style.top = `${Math.random() * 100}vh`;
                    
                    // Blue color variations
                    const colors = ['#00ccff', '#0066ff', '#0044cc', '#003399'];
                    orb.style.background = colors[i % colors.length];
                    
                    body.appendChild(orb);
                }
            }
            
            // Call the function to create the animated background
            createAnimatedBackground();
    </script>
</body>
</html>
